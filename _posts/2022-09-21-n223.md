---
layout: single
title: "모델의 전처리"
categories: review
tag: [ML]
toc: true


---



# 모델의 유형과 전처리

## Linear / Logisitc Regression

수치 간의 곱셈이나 덧셈 등의 연산으로 예측이 이루어지는 방법들의 경우들에 해당됨

1. 입력 특성들 크기/범위/분포에 영향을 받음
   - 입력 특성들을 표준화 등을 시도해 모델 성능을 향상시킬 수 있는 분포와 범위로 바꿔야 함
2. 결측치를 반드시 채워야 함
   - 이 모델들은 수치간의 대수적 연산으로 예측이 이루어지기 때문에 모든 값들을 수치형으로 바꿔야 함
3. 비선형적 특성이나 특성 간 상호작용 등을 미리 처리해주어야 함
   - 이 모델들은 각 특성이 독립적으로 타겟과 선형적으로 관련이 되어 있다고 가정함
     - 그렇기에 선형적이지 않을 것으로 예상되는 특성들에 대해서 선형관계를 갖도록 값들을 변환해 주어야 함





## Tree Based Models

1. 입력 특성들의 크기/범위/분포에 영향을 받지 않음
2. 결측치를 반드시 채울 필요는 없음
   - 결측치 집단을 하나의 집단으로 분기할 수 있음
     - xgboost는 이방법을 default로 지원하지만 sklearn에서는 결측치를 모델 내에서 자체적으로 처리하는 방법 지원하지 않음
3. 특성과 타겟 사이의 상호작용이 자동으로 반영될 수 있음
   - 모델이 분기해서 내려가는 과정에서 특성들 상호작용이 자동으로 반영됨





------



# 결측치 처리 방법

결측치가 발생한 이유?

- 조건부로 존재하는 특성의 경우 발생할 수 있음
  - ex) 특정 성별에게만 해당되는 건강정보
- 설문조사 등의 데이터의 경우 응답자가 응답을 원하지 않아 결측치가 발생함
  - 결측치 자체에서 주는 시그널을 파악해야 함
- 데이터 다운로드, 가공, 정제하는 과정에서의 데이터 엔지니어의 실수



그렇다면 결측치를 처리하는 방법은?

- 결측치 그대로 두기
  - 개인의 내밀하고 개인적인 이슈에 대한 응답은 결측치가 많이 발생한다.
  - 회귀의 경우 Boolean특성으로 결측치 유무를 판단하는 특성을 만들어 이에 해당하는 조건은 제외하고 모델을 만들 수 있음
  - 트리 모델은 결측치 핸들링할 필요 없음
- 단일 대표값으로 채우기
  - 다른 특성들과 무관하게 랜덤으로 발생한 경우
  - 데이터가 충분히 크고, 결측치가 많지 않을 때(전체 데이터의 10%내외)
  - sklearn의 SimpleImputer의 strategy 파라미터 조정
    - mean, median, most_frequent, constant
- 다른 특성들로부터 조건부로 채우기
  - 특성 간 상관관계 정보 또는 데이터로부터 파악한 정보를 기반으로 결측치를 조건부로 채울 수 있음
    - ex) 성별 별로 키에 따라 정렬한 뒤 몸무게를 인접한 키를 갖는 사람의 몸무게로 대체



------



# 수치형 변수 전처리

## 스케일만 변환

- Min-Max Scaling
  - 해당 특성의 이상치가 정상치로부터 크게 벗어나지 않을 때
  - 특성값들의 분포가 전체 범위에서 균등분포를 보일 때
  - 간단히 적용가능하나 변환후 평균이 0이 되지 않고 이상치에 영향 크게 받음
- Standardization
  - 이상치에 덜 민감해 이상치 분포를 정확히 파악하기 어려울 때 첫시도로 사용
  - 분포를 정규분포 모양으로 바꿔주지는 않음





## 스케일과 형태 변환

- Clipping
  - 특정 범위를 넘어서는 값들을 해당 경계값으로 변환시켜 줌
  - 정상범위에서 비정상적인 값이 튀는 이상치가 있을 때 쉽게 사용 가능
- 로그변환
  - 다수의 값들이 제한된 범위내에서만 존재하고 특정 값들이 매우 큰 형태의 분포에서 자주 사용
    - ex) 인터넷 기사의 댓글 수 분포
  - 음이아닐 때만 적용 가능
- Bucketing
  - 수치형 변수를 범주형과 같이 다루는 방법
  - 범위를 미리 지정한 뒤 각 값들이 어떤 범위에 속하는지 숫자로 나타냄
  - 범위 지정 방법
    - quantile : 각 범위 내에 동일한 수의 데이터가 들어가도록 범위를 쪼갬
    - uniform : 각 범위를 동일한 간격을 갖도록 쪼갬
    - 기존 사전 지식에 따라 범위를 쪼갬
      - ex) 집값 특성에서 과세표준을 기준으로 나누기
- Rank 변환
  - 값들을 전체 데이터에서의 순위로 변환
  - 장점 : 이상치에 민감하지 않고 균등 분포로 변환시켜줌
  - 단점 : 값들간의 거리 정보들이 삭제되고 대소관계만 남음
  - pandas라이브러리의 rank기능 사용
    - 없던 데이터가 들어왔을 땐 변환 불가능
      - sklearn의 QuatileTransformer 사용 가능



------

# 범주형 변수 전처리

- One-Hot Encoding 
  - 범주형 특성 값들을 0과 1의 값으로(해당유무) 인코딩 (명목형)
  - cardinality가 너무 큰 경우 차원이 매우 커지기에 적절하지 못한 방법
  - 트리 기반 모델에서는 특성 정보를 분산시켜 비효율적인 트리를 만들어 잘 사용하지 않음
- Ordinal Encoding
  - 범주형 특성 값들을 단순히 서로 다른 정수값들로 인코딩 (순서형)
  - 회귀모델의 경우 명목형 변수를 Ordinal Encoding 해주는 것은 적절치 못함
    - 대소관계 때문에
  - 트리 기반 모델에서는 원핫인코딩에 비해 효율적임
- Count Encoding (Frequency Encoding)
  - 각 카테고리의 등장 빈도가 중요한 정보가 되는 경우
    - ex) 골동품 데이터의 경우 희귀할수록 가격이 올라감
  - 장점
    - 구현,해석이 쉽고 특성 차원을 늘리지 않으며 특성 빈도 정보를 모델에게 명시적으로 제공 가능
  - 단점
    - 동일한 빈도를 갖는 서로다른 특성값이 구분되지 않음
    - 새로운 데이터에 대해 대응하기 어려움
- Target Encoding (Mean Encoding)
  - 범주형 특성값들을 해당 특성을 갖는 데이터의 타겟값의 평균으로 인코딩하는 방법
  - 장점
    - 해석이 쉽고 특성의 차원을 늘리지 않고 특성값과 타겟값 간의 직접적인 관계를 모델링 해 모델에게 중요한 정보를 제공할 수 있음
  - 단점
    - 동일한 평균 타겟값을 갖는 서로다른 특성값이 구분되지 않음
    - 과적합 문제가 발생할 수 있음
      - 인코딩된 값만 보더라도 타겟값을 어느정도 예측가능
      - 학습 데이터에 특성값이 충분히 없다면 값이 misleading됨
    - TargetEncoder 라이브러리
      - 위와 같은 문제들을 해결하기 위해 특성의 출현 빈도까지 함께 고려해 범주형 값을 인코딩 해줌





