---
layout: single
title: "이상 탐지 모델"
categories: AI
tag: [인공지능, 이상탐지, 머신러닝, 딥러닝]
toc: true


---



# 들어가기 앞서
요즘 진행중인 <a href="https://aifactory.space/competition/detail/2299">제 4회 2023 연구개발 특구 AI SPARK 챌린지 </a> 에서 산업용 공기압축기 및 회전기기에서 모터 및 심부 온도, 진동, 노이즈 등이 기기 피로도에 영향을 주는 요소이며 이때문에 피로도 증가 시 산업기기 이상 전조증상을 예측해 기기 고장을 예방하는 모델을 개발하는 것이 목표인 대회에 참가하게 되어 이상 탐지 모델에 대해 학습하기로 했다.

<br>


# 이상 탐지(Anomaly Detection)이란?

<p>
데이터에서 <b>예상과는 다른 패턴</b>을 보이는 개체 또는 자료를 찾는 것을 말한다. 학습 데이터를 기반으로 기존 데이터들과는 다른 특성을 갖는 데이터를 찾는 모형을 만드는 방법이며 대표적으로 신용카드 사기, 사이버 침입, 테러 행위 같은 악의적 행동이나 시스템 고장, 비정상적인 상황 등에 활용됨
</p>

<br>

## 다른 문제들과 혼동?
이상 탐지는 종종 다른 문제와 혼동되는데 엄연한 차이가 있다. <br>
- <b>분류</b> : 두 범주를 구분할 수 있는 경계면을 찾는 것
- <b>이상탐지</b> : 다수의 범주를 고려해 이상치가 아닌 데이터들의 sector를 구분 짓는 것
- <b>Noise Detection</b> : 노이즈는 분석 이전 단계에서 불필요한 개체 또는 제거해야할 성분을 말하며 이를 조정함으로써 통계 모형 추정에서 이상치의 영향을 줄일 수 있다.
- <b>Novelty Detection</b> : 지금까지 발견되지 않았던 새로운 패턴을 찾아내는 것을 목표로 합니다. 이상탐지와 달리 novelty는 정상치에 포함된다.

<br>
<br>

## 다양한 접근

이상 탐지를 위해서는 다양한 접근이 가능하다.
크게 <b>분류기반, NN 기반, 군집화 기반, 통계적 기법, 스펙트럴 기법</b> 등으로 나뉜다.

### 1. 분류 기반 기법
여러 분류 알고리즘을 이용할 수 있는 장점이 있다. <br>
오토인코더 (Autoencoder), 베이지안 네트워크 (Bayesian network), 서포트 벡터 머신(SVM), 결정 규칙(Decision Rule) 기반 알고리즘이 있다. <br>

<br>
<br>

### 2. NN 기반 기법

정상치가 어떤 근방 (Neighbor)에 밀집되어 있고 이상치가 각 근방에서 멀리 떨어져 있다는 가정을 전제로 한다. 이 기법을 쓰기 위해서는 두 개체 사이 거리 개념이 정의되어야 하며 데이터 유형에 따라 여러 방법을 적용할 수 있다. <br>
- 연속형 변수 : 유클리드 거리
- 범주형 변수 : 단순 일치 계수
- 다변량 데이터 : 각 변수에 대한 거리를 결합해 사용

<hr>

- 장점 : 비지도 학습 또는 준지도 학습을 기반으로 하고, 거리 개념만 잘 정의된다면 자료 형태에 구애 받지 않는다.
- 단점 : 테스트 과정에서 각각의 근방을 구해야 하므로 시간이 오래 걸린다.
<hr>

<u><b>이상 점수를 구하는 방법 </u></b>
- K번째로 가까운 개체와의 거리를 이용
    - 이상 점수를 기준으로 정렬시킨 뒤 가장 큰 k개를 이상 개체로 보는 방법
- 상대 밀도 (Relative Density)를 이용
    - 각 객체 근방의 밀도를 추정해 낮은 밀도의 개체를 이상 개체로 판단하는 방법


<br>
<br>

### 3. 군집화(Clustering) 기반 기법
근본 가정에 따라 세 종류로 나뉜다.
1. 정상치가 하나 또는 몇개의 군집에 모여있고 이상치는 군집에 속하지 않는다.
    - 모든 개체를 군집에 넣지 않아도 되는 DBSCAN, SNN 군집화 알고리즘을 활용한다.
    - 단점 : 군집을 찾아내는 것이 주된 목적이므로 이상 탐지에 최적화되어 있지 않다.
2. 군집의 중심 중 가장 가까운 것과의 거리가 긴 것을 이상치라고 본다.
    - 먼저 군집화를 하고 개체가 포함된 군집의 중심과 개체 사이의 거리를 이상점수로 놓는다.
    - 학습데이터를 군집화하고 테스트 개체를 군집과 비교해 이상 점수를 얻는 식이므로 준지도 기법이라 본다.
    - 자기 조직화 지도(SOM, Self-organizing Map), K-Means등을 이용한다.
3. 정상치는 크거나 조밀한 군집에 이상치는 작거나 sparse한 군집에 속한다.
    - 개체가 속한 군집의 크기나 밀도가 이상 여부를 판단하는 기준이 된다.
    - 한 쌍의 관측치들 간의 거리 계산이 필요하므로 NN 기반 이상 탐지 기법과 유사하다.
        - 차이점
            - 군집화 기반 이상 탐지 기법 : 자신이 속한 클러스터와 관련해 각 관측치를 평가
            - NN 기반 기법 : 가까이 존재하는 로컬 이웃에 대해 각 관측치를 분석

<br>
<br>

### 4. 통계적 기법
- 근본적으로 이상치가 가정된 확률 분포에서 생성되지 않았기 때문에 부분 또는 완전히 동 떨어졌다고 여겨지는 관측값이라고 정의한다. 
- 이상치는 확률 분포에서 낮은 영역에서 나타난다는 가정을 전제로 한다.
- 주어진 자료로 정상 데이터 모형을 적합한 뒤 통계적 추론을 통해 새로운 개체가 그 모형을 따르는지 판단한다.


<br>
<br>


### 5. 스펙트럴 기반 기법
변수들의 조합으로 자료의 변동 (Variability)을 대부분 설명하도록 자료를 근사한다. 데이터를 더 낮은 차원의 부분 공간 (Subspace)으로 보내면 (Embed), 그 공간에서는 정상과 이상이 확연히 구분된다는 가정을 전제로 한다.
- PCA (주성분 분석) : 주로 사용하는 기법이며 데이터를 저차원 공간으로 사영시켰을 때 데이터의 상관 구조를 만족하는 정상 개체는 사영값이 낮고 상관 구조에서 벗어난 이상 개체는 높은 값을 보이게 되는 방식이다.
- 계산복잡도 : 일반적으로 데이터 크기에 선형시간으로, 차원에는 제곱시간으로 비례한다.
    - 비선형 기법을 쓰면 차원에 선형이 되도록 줄일 수 있지만 주성분 개수에 대해 다항식 시간이 된다.
    - 특이값 분해를 사용하는 깁버은 자료 크기에 제곱시간이다.
- 고차원 데이터 처리에 적합하며, 다른 기법 적용을 위한 전처리 처럼 사용하는 것도 가능하다.
- 자료를 보낼 저차원 공간에서 정상, 이상치가 제대로 분리되어야만 유용하다.

<br>
<br>
<br>
<br>
<hr>

# 이상 탐지 알고리즘 종류
## 1. 지도 학습
- XGBoost
- RandomForest
- SVM(Support Vector Machine)
- KNN (K-Nearest Neighbors)

## 2. 준지도 학습
- One Class SVM

## 3. 비지도 학습
딥러닝
- Isolation Forest
    - 랜덤으로 임의의 데이터를 2가지 부분으로 분리하여 모든 관측치 데이터를 고립시킨다.
    - ITree에서 분할 과정을 계속 반복한다.
    - 고립되기 가장 쉬운 포인트가 이상 데이터일 가능성이 가장 높다.
- Deep Autoencoder

머신러닝
- K-means
- DBSCAN
- GMM (Gaussian Mixture Model)



